import { useContext } from 'react'
import ConfigurationContext from './src/context/Configuration'

const ensureTrailingSlash = (value) =>
  value.endsWith('/') ? value : `${value}/`

const deriveHttpOrigin = (restUrl) =>
  ensureTrailingSlash(restUrl.replace(/\/api(?:\/v\d+)?\/?$/, '/'))

const REST_BASE_URL = 'https://ftifto-backend.onrender.com/api/v1'
const GRAPHQL_URL = 'https://ftifto-backend.onrender.com/graphql'
const WS_GRAPHQL_URL = 'wss://ftifto-backend.onrender.com/graphql'

/**
 * Rename this file to `environment.js` to override the defaults.
 * All URLs point to production backend - no localhost configuration.
 */
const useEnvVars = () => {
  const configuration = useContext(ConfigurationContext)

  const shared = {
    IOS_CLIENT_ID_GOOGLE: configuration?.iOSClientID,
    ANDROID_CLIENT_ID_GOOGLE: configuration?.androidClientID,
    GOOGLE_MAPS_KEY: configuration?.googleApiKey,
    EXPO_CLIENT_ID: configuration?.expoClientID,
    TERMS_AND_CONDITIONS: configuration?.termsAndConditions,
    PRIVACY_POLICY: configuration?.privacyPolicy,
    TEST_OTP: configuration?.testOtp
  }

  // Always use production URLs - no localhost fallback
  return {
    GRAPHQL_URL: GRAPHQL_URL,
    WS_GRAPHQL_URL: WS_GRAPHQL_URL,
    SERVER_URL: GRAPHQL_URL,
    SERVER_REST_URL: REST_BASE_URL,
    REST_BASE_URL: REST_BASE_URL,
    ...shared
  }
}

export default useEnvVars
